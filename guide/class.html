<!DOCTYPE HTML>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Defining Ema instance – Ema</title><meta name="description" content="Ema static site generator (Jamstack) in Haskell"><link href="/ema.svg" rel="icon" /><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#DB2777"><link href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-tomorrow.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/combine/npm/prismjs@1.23.0/prism.min.js,npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/combine/npm/twind/twind.umd.min.js,npm/twind/observe/observe.umd.min.js"></script><script type="text/javascript">twind.setup({})
twindObserve.observe(document.documentElement)</script></head><body class="overflow-y-scroll"><div class="flex justify-center p-4 bg-pink-600 text-gray-100 font-bold text-2xl"><div><b>WIP: </b>Documentation is still being written</div></div><div class="container mx-auto xl:max-w-screen-lg"><div class="px-2 grid grid-cols-12"><div class="hidden md:block md:col-span-3 overflow-x-auto"><div class="pl-2 mt-8"><div class=" my-2 "><a href="/">Ema</a></div></div><div class="pl-2"><div class=" my-2 "><a href="/start">Getting Started</a></div><div class="pl-2"></div><div class=" my-2 "><a href="/guide">Guide</a></div><div class="pl-2"><div class=" my-2 text-gray-600"><a href="/guide/model">Defining your model</a></div><div class="pl-2"></div><div class=" my-2 text-gray-600"><a href="/guide/routes">Working with routes</a></div><div class="pl-2"></div><div class="text-pink-600 my-2 text-gray-600"><a href="/guide/class">Defining Ema instance</a></div><div class="pl-2"></div><div class=" my-2 text-gray-600"><a href="/guide/render">Rendering HTML</a></div><div class="pl-2"></div><div class=" my-2 "><a href="/guide/helpers">Helpers</a></div><div class="pl-2"><div class=" my-2 text-gray-600"><a href="/guide/helpers/tailwind">Using Tailwind CSS</a></div><div class="pl-2"></div><div class=" my-2 text-gray-600"><a href="/guide/helpers/filesystem">Working with files</a></div><div class="pl-2"></div><div class=" my-2 text-gray-600"><a href="/guide/helpers/markdown">Converting Markdown</a></div><div class="pl-2"></div></div></div><div class=" my-2 "><a href="/concepts">Concepts</a></div><div class="pl-2"><div class=" my-2 text-gray-600"><a href="/concepts/hot-reload">Hot Reload</a></div><div class="pl-2"></div><div class=" my-2 text-gray-600"><a href="/concepts/lvar">LVar</a></div><div class="pl-2"></div><div class=" my-2 text-gray-600"><a href="/concepts/slug">Slug</a></div><div class="pl-2"></div><div class=" my-2 text-gray-600"><a href="/concepts/cli">CLI</a></div><div class="pl-2"></div><div class=" my-2 text-gray-600"><a href="/concepts/logging">Logging</a></div><div class="pl-2"></div></div></div></div><div class="col-span-12 md:col-span-9"><div class="w-full text-gray-600 mt-4"><div class="flex justify-center"><div class="w-full bg-white py-2 rounded"><ul class="flex text-gray-500 text-sm lg:text-base"><li class="inline-flex items-center"><a class="px-1 font-bold bg-pink-500 text-gray-50 rounded" href="/">Ema</a><svg fill="currentColor" viewBox="0 0 20 20" class="h-5 w-auto text-gray-400"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></li><li class="inline-flex items-center"><a class="px-1 font-bold bg-pink-500 text-gray-50 rounded" href="/guide">Guide</a><svg fill="currentColor" viewBox="0 0 20 20" class="h-5 w-auto text-gray-400"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></li><li class="inline-flex items-center text-gray-600"><a>Defining Ema instance</a></li></ul></div></div></div><h1 class="text-6xl my-2 text-center pb-2" id="defining-ema-instance">Defining Ema instance</h1><p class="my-2">Once you have <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/model" title="">model</a> and <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/routes" title="">route</a> types in place, we must tell the Haskell compiler that they are suitable for generating static sites. We do this by creating an instance of the <code>Ema</code> typeclass.</p><p class="my-2">Using some <code>MyModel</code> and the route <code>Route</code> shown in the <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/routes" title="">previous</a> section, we can create an instance as follows:</p><pre class="haskell language-haskell"><code class="haskell language-haskell">class Ema MyModel Route where 
  -- Convert our route to browser URL, represented as a list of slugs
  encodeRoute = \case
    Index -&gt; []  -- An empty slug represents the index route: index.html
    About -&gt; [&quot;about&quot;]

  -- Convert back the browser URL, represented as a list of slugs, to our route
  decodeRoute = \case
    [] -&gt; Just Index
    [&quot;about&quot;] -&gt; Just About
    _ -&gt; Nothing

  -- The third method is used during static site generation. 
  -- This tells Ema which routes to generate .html files for.
  staticRoutes model =
    [Index, About]

  -- The fourth method is optional; if you have static assets to serve, specify
  -- them here. Paths are relative to current working directory.
  staticAssets Proxy =
    [&quot;css&quot;, &quot;images&quot;, &quot;favicon.ico&quot;, &quot;resume.pdf&quot;]</code></pre><p class="my-2">This instance does the following:</p><ol class="list-inside ml-2 list-decimal"><li class="py-1.5 ">Define <code>encodeRoute</code> that converts our route type to a browser URL <a class="text-pink-600 font-bold hover:bg-pink-50" href="/concepts/slug" title="">slug</a> path representing relative URLs like <code>/foo/bar</code></li><li class="py-1.5 ">Define <code>decodeRoute</code> that does the <em>reverse</em> converstion (the conversion must be isomorphic)</li><li class="py-1.5 ">Define <code>staticRoutes</code> that returns the list of routes to statically generate</li><li class="py-1.5 ">Optionally, define the list of static assets to copy over as-is during static generation</li></ol><h2 class="text-5xl my-2" id="runema"><code>runEma</code></h2><p class="my-2">The <code>Ema</code> constraint is used by the <code>runEma</code> function that acts as the main entry point to your static site generator. It takes two arguments:</p><ol class="list-inside ml-2 list-decimal"><li class="py-1.5 "><code>render</code> function that renders your HTML (we’ll go over this in <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/render" title="">the next</a> section)</li><li class="py-1.5 ">an IO action that takes <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/model" title=""><code>LVar model</code></a> as an argument.</li></ol><p class="my-2">This IO action is expected to be a long-running one, wherein you have full control over setting the value of the model over time.</p><div class="mt-8 border-t-2 border-pink-500 pb-1 pl-1 bg-gray-50 rounded"><p class="my-2"><span class="py-2 text-xl italic font-bold">Next</span>, with our model and routes in place constrained by <code>Ema</code> type class, <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/render" title="">we will define the HTML for our site</a> using Ema.</p></div></div></div><footer class="mt-8 text-center text-gray-500">Powered by <a class="font-bold" target="blank" rel="noopener" href="https://github.com/srid/ema">Ema</a></footer></div></body></html>